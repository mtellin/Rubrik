---
# Run this through https://www.json2yaml.com/ to convert back to JSON
Version: '2020-09-01'
Statement:
- Sid: RubrikCloudOnv52
  Effect: Allow
  Action:
  - ec2:DescribeInstances
  - ec2:CreateKeyPair
  - ec2:CreateImage
  - ec2:CopyImage
  - ec2:DescribeSnapshots
  - ec2:DescribeVolumes
  - ec2:DescribeExportTasks
  - ec2:DescribeAccountAttributes
  - ec2:ImportImage
  - ec2:DescribeKeyPairs
  - ec2:CancelExportTask
  - ec2:CreateTags
  - ec2:CreateVolume
  - ec2:DescribeImportSnapshotTasks
  - ec2:DescribeSubnets
  - ec2:DeregisterImage
  - ec2:ImportVolume
  - ec2:DescribeInstanceAttribute
  - ec2:DescribeAvailabilityZones
  - ec2:CreateSnapshot
  # Rubrik added the "ec2:ModifyInstanceAttribute" as deleteOnTermination attribute has to be added to the instance after launching it so volumes attached to the instance are not leaked once the instance is terminated.
  - ec2:ModifyInstanceAttribute
  - ec2:DescribeInstanceStatus
  - ec2:CreateInstanceExportTask
  - ec2:ImportInstance
  - ec2:DescribeTags
  - ec2:CancelConversionTask
  - ec2:ImportSnapshot
  - ec2:DescribeImportImageTasks
  - ec2:DescribeSecurityGroups
  - ec2:DescribeImages
  - ec2:DescribeVpcs
  - ec2:CancelImportTask
  - ec2:DescribeConversionTasks
  - ec2:GetConsoleScreenshot
  - ec2:GetConsoleOutput
  # Nope, I don't think any CloudOn or CloudOut functionality will be impacted by removing the ListMyBucket permission. -from Anant
  - s3:ListAllMyBuckets
  Resource: "*"
- Sid: RubrikCloudOnRestricted
  Effect: Allow
  Action:
  - ec2:AttachVolume
  - ec2:DeleteVolume
  - ec2:DeleteSnapshot
  - ec2:DeleteTags
  - ec2:DetachVolume
  - ec2:RunInstances
  - ec2:StartInstances
  - ec2:StopInstances
  - ec2:TerminateInstances
  Resource: "*"
  Condition:
    ForAnyValue:StringEquals:
      ec2:ResourceTag/rk_instance_class:
      - TransientStormInstance
      - UserInstantiatedInstance
      - PolicyBasedImage
      - OnDemandImage
      - TestConnectivityInstance
      - BootstrappedStormImage
      - VolumeGeneratedCloudSnapshot
- Sid: RubrikCloudOutS3Restricted
  Effect: Allow
  Action:
  - s3:CreateBucket
  - s3:DeleteBucket
  - s3:DeleteObject
  - s3:GetBucketLocation
  - s3:GetObject
  - s3:ListBucket
  - s3:PutObject
  - s3:AbortMultipartUpload
  - s3:ListMultipartUploadParts
  - s3:RestoreObject
  Resource:
  - arn:aws:s3:::rubrik-bucket
  - arn:aws:s3:::rubrik-bucket/*